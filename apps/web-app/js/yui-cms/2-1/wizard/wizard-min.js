/*
Copyright (c) 2008, Bubbling Library Team. All rights reserved.
Portions Copyright (c) 2008, Yahoo!, Inc. All rights reserved.
Code licensed under the BSD License:
http://www.bubbling-library.com/eng/licence
version: 2.1
*/
(function(){var D=YAHOO.lang,C=YAHOO.util.Connect,A=YAHOO.util.Event,B=YAHOO.util.Dom,E=YAHOO.util.Dom.get,F=YAHOO.plugin.Dispatcher;YAHOO.plugin.WizardManager=function(){var P={},M=null,U={},Y="yui-cms-wizard",I="yui-cms-form",H="dynamic",R="loading",J="yuicmswizard",O={status:false,handle:null,done:false,uri:null,moreGetData:{},morePostData:{},onCancel:null,onReady:null,onFinish:null,onSubmit:null,values:{}};var K={success:function(a){var Z=P._area=a.argument.area;F.process(Z.element,a.responseText,{onStart:function(){},error:function(){L(Z)},onLoad:function(){B.removeClass(Z.element,R);if(Z.values._wizardfinish||Z.done){X(Z)}else{if(Z.values._wizardcancel){N(Z)}}V(Z)},firewall:Z.firewall},true);P._area=null},failure:function(Z){L(Z.argument.area)}};function Q(a,Z,b,e,d){B.addClass(a.element,R);b=F.firewall(b,a);if(D.isFunction(a.onStart)){a.onStart.apply(a,[a.values]);a.onStart=null}if(YAHOO.Bubbling){YAHOO.Bubbling.fire("onAsyncRequestStart",{element:a.element})}a.handle=C.asyncRequest(Z,b,e,d)}function T(e,d){var b=[],c=e.getElementsByTagName(d);for(var a=0,Z=c.length;a<Z;a++){b.push(c[a])}return b}function V(Z){var f=[],d,l,h,i,g;if(D.isObject(Z)&&D.isObject(Z.element)){if(!Z.overheat){f=T(Z.element,"button");for(var b=0,e=f.length;b<e;b++){if(!B.getAncestorByClassName(f[b],"yui-button")){l=new YAHOO.widget.Button(f[b],{className:f[b].className})}}f=T(Z.element,"input");for(var b=0,e=f.length;b<e;b++){l=f[b].getAttribute("type").toLowerCase();h=f[b].getAttribute("value");if(D.isObject(YAHOO.widget.Button)&&((l=="submit")||(l=="reset")||(l=="button"))){h='<div class="i">'+h+"</div>";l=new YAHOO.widget.Button(f[b],{label:h,className:f[b].className})}}}f=T(Z.element,"form");for(var b=0,e=f.length;b<e;b++){i=f[b];if(!B.hasClass(i,I)){B.addClass(i,I);Z.morePostData[J]=Z.id;var a={upload:K.success,success:K.success,failure:K.failure,argument:{area:Z}};A.on(i,"submit",function(p){var n=this,o=null,k=n.getAttribute("action",2)||Z.uri,c=(n.getAttribute("method").toLowerCase()=="post"?"POST":"GET");C._formNode=n;for(o in Z.morePostData){if(Z.morePostData.hasOwnProperty(o)){C.appendPostData(o+"="+Z.morePostData[o])}}S(Z);if(D.isObject(YAHOO.widget.Button)){YAHOO.widget.Button.addHiddenFieldsToForm(n)}if(D.isObject(YAHOO.widget.EditorInfo)&&D.isObject(YAHOO.widget.EditorInfo._instances)){for(j in YAHOO.widget.EditorInfo._instances){if(YAHOO.widget.EditorInfo._instances.hasOwnProperty(j)){YAHOO.widget.EditorInfo._instances[j].saveHTML()}}}if(!B.hasClass(n,"yui-cms-simpleform")){k=F.augmentURI(k,Z.moreGetData);C.setForm(n,B.hasClass(n,"yui-cms-upload"));Q(Z,c,k,a);C.resetFormState();A.stopEvent(p)}})}}Z.status=true;G(Z)}}function W(c,b){var a,Z="",d;b=new String(D.isString(b)?b:c.uri);b+=((b.indexOf("?")==-1)?"?":"&")+J+"="+c.id;b=F.augmentURI(b,c.moreGetData);d=F.obj2query(c.morePostData);if(D.isObject(c)&&D.isObject(c.element=E(c.id))&&b){var e={success:K.success,failure:K.failure,argument:{area:c}};Q(c,c.loadMethod,b,e,d);if(YAHOO.Bubbling){YAHOO.Bubbling.fire("onNavigate",{state:c.id+escape(b),control:"wizard",uri:b,area:c,restore:function(){W(c,b)}})}}}var S=function(Z){if(D.isFunction(Z.onSubmit)){Z.onSubmit.apply(Z,[Z.values])}};var X=function(Z){if(D.isFunction(Z.onFinish)){Z.onFinish.apply(Z,[Z.values])}};var N=function(Z){if(D.isFunction(Z.onCancel)){Z.onCancel.apply(Z,[Z.values])}};var L=function(Z){if(D.isFunction(Z.onError)){Z.onError.apply(Z,[Z.values])}};var G=function(Z){if(D.isFunction(Z.onReady)){Z.onReady.apply(Z,[Z.values])}};P.getStatus=function(Z){if(D.isObject(U[Z])){return U[Z].status}return false};P.getValues=function(Z){if(this.getStatus(Z)){return U[Z].values}return false};P.setValues=function(c,Z){if(this.getStatus(c)){var a=U[c];try{a.values=D.JSON.parse(Z)}catch(b){L(a)}return a.values}return null};P.valuer=function(Z){var a=this._area;if(D.isString(Z)&&D.JSON){try{Z=D.JSON.parse(Z)}catch(b){Z={};L(a)}}Z=(D.isString(Z)||!D.isObject(Z)?{}:Z);D.augmentObject(a.values,Z,true);return a.values};P.finisher=function(){if(this._area){this._area.done=true}};P.jump=function(a,Z){if(this.getStatus(a)){W(U[a],Z);return true}return false};P.init=function(b,Z){var a=Z||O;if(D.isObject(b)){b=A.generateId(b)}if(D.isObject(U[b])){D.augmentObject(a,U[b],true)}a.morePostData=a.morePostData||{};a.moreGetData=a.moreGetData||{};if(D.isObject(a.dataMask)){D.augmentObject(a.morePostData,a.dataMask,true);D.augmentObject(a.moreGetData,a.dataMask,true)}a.loadMethod=((D.isString(a.loadMethod)&&a.loadMethod.toLowerCase()=="post")?"POST":"GET");if(a.dynamic){B.addClass(a.id,H)}B.addClass(a.id,Y);U[a.id]=a;return a};P.add=function(d,a){var b=a||O,Z=b.id||d||b.element;if(D.isString(Z)&&(Z!=="")){Z=E(Z)}if(D.isObject(Z)&&D.isString(b.uri)&&(b.uri!=="")){b.id=A.generateId(Z);b.element=Z;b.handle=null;b.status=false;b.values={};this.remove(b.id);this.init(d,b);W(U[d])}return U[d]};P.adopt=function(d,a){var b=a||O,Z=b.id||d||b.element;if(D.isString(Z)&&(Z!=="")){Z=E(Z)}if(D.isObject(Z)){b.id=A.generateId(Z);b.element=Z;b.handle=null;b.status=false;b.values={};this.remove(b.id);this.init(d,b);V(U[b.id])}return U[d]};P.delegate=function(a,b,Z){Z=Z||{};Z.action="tabview";Z.uri=a.get("dataSrc")||null;Z.tab=a;Z.moreGetData=Z.moreGetData||{};if(D.isObject(Z.dataMask)){D.augmentObject(Z.moreGetData,Z.dataMask,true)}a.set("dataSrc",F.augmentURI(Z.uri,Z.moreGetData));a.loadHandler.success=function(d){var c=a.get("contentEl");Z.tab=c;Z.underground=true;F.process(a,d.responseText,Z);B.addClass(c,H);P.adopt(c,Z);if(YAHOO.Bubbling){YAHOO.Bubbling.fire("onAsyncRequestEnd",{element:c})}};a.on("activeChange",function(){if(YAHOO.Bubbling&&this.get("active")&&a.get("dataSrc")&&!this.get("cacheData")){YAHOO.Bubbling.fire("onAsyncRequestStart",{element:this.get("contentEl")})}});if(D.isObject(b)){b.addTab(a)}};P.remove=function(Z){if(D.isObject(Z)){Z=A.generateId(Z)}if(Z&&(U[Z])){U[Z].handle=null;U[Z]=null}U[Z]=[]};P.reload=function(a,Z){if(D.isObject(a)){a=A.generateId(a)}if(a&&(U[a])){W(U[a],Z)}};return P}()})();YAHOO.util.WizardManager=YAHOO.plugin.WizardManager;YAHOO.register("wizard",YAHOO.plugin.WizardManager,{version:"2.1",build:"242"});